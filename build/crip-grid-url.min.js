!function(r,e){"use strict";e.gridUrl=r.module("crip.grid-url",["crip.core","crip.grid"])}(angular,window.crip||(window.crip={})),function(r,e){"use strict";function i(){function r(){return{getMappings:e}}function e(){return n}function i(r,e,i,a,o,t,c){return n={page:r||"grid-page",perPage:e||"grid-per-page",total:i||"grid-total",direction:a||"grid-direction",order:o||"grid-order",filters:t||"grid-filters",name:c||"grid-name"}}var n=i();this.getMappings=e,this.setMappings=i,this.$get=[r]}e.gridUrl.provider("cripGridUrlConfig",i),i.$inject=[]}(angular,window.crip||(window.crip={})),function(r,e){"use strict";function i(e,i,n,a){function o(e){function o(r){i.search(g.name,e.name),i.search(g.page,e.scope.grid.pagination.page),i.search(g.total,e.scope.grid.pagination.total),i.search(g.perPage,e.scope.grid.pagination.perPage),i.search(g.direction,e.scope.grid.sort.direction),i.search(g.order,e.scope.grid.sort.field),t(function(r){i.search(r,null)});for(var n in e.scope.grid.filters)e.scope.grid.filters.hasOwnProperty(n)&&i.search(n,e.scope.grid.filters[n])}function t(n){var a=i.search();r.forEach(a,function(r,i){-1===e.scope.grid.url.params.indexOf(i)&&n(i,r)})}function c(){var r={};return t(function(e,i){r[e]=i}),r}function p(r,e,n){n=n||r;var a=i.search()[r]||e[n];return a}function s(){var r=e.name,n=i.search()[g.name];return n&&n===r?!0:n?!1:(i.search(g.name,r),!0)}var g=n.getMappings();e.scope.grid.url={params:[g.page,g.perPage,g.total,g.direction,g.order,g.filters,g.name]},s()&&(e.scope.grid.pagination.page=p(g.page,e.scope.grid.pagination,"page"),e.scope.grid.pagination.total=p(g.total,e.scope.grid.pagination,"total"),e.scope.grid.pagination.perPage=p(g.perPage,e.scope.grid.pagination,"perPage"),e.scope.grid.sort.direction=p(g.direction,e.scope.grid.sort,"direction"),e.scope.grid.sort.field=p(g.order,e.scope.grid.sort,"field"),e.scope.grid.filters=c()||e.scope.grid.filters),e.scope.$on(a.dataChanged,function(r,e){s()&&i.search(g.total,e.total)}),e.scope.$on(a.filtersChanged,function(e,n){s()?(t(function(e){r.isDefined(n.filters[e])||i.search(e,null)}),r.forEach(n.filters,function(r,e){i.search(e,r)})):o(1)}),e.scope.$on(a.sortChanged,function(r,e){s()?(i.search(g.direction,e.direction),i.search(g.order,e.field)):o(2)}),e.scope.$on(a.paginationChanged,function(r,e){s()?(i.search(g.page,e.page),i.search(g.perPage,e.perPage),i.search(g.total,e.total)):o(3)}),e.scope.$watch(function(){return i.search()},function(n,o){if(s()){var t=r.equals,p=!!t(n,o),d=g.perPage,l=n[d];-1===e.scope.grid.pagination.pageSizes.indexOf(l)&&i.search(d,o[d]),p||e.scope.$broadcast(a.externallyChanged,{sort:{field:n[g.order],direction:n[g.direction]},pagination:{page:n[g.page],total:n[g.total],perPage:n[d]},filters:c(),name:n[g.name]})}});var d=r.injector();r.forEach(e.plugins,function(r,i){var n=d.get(i);n.extend({scope:e.scope,paginate:e.paginate,name:e.name,plugins:r})})}return{extend:o}}e.gridUrl.factory("cripGridUrl",i),i.$inject=["$log","$location","cripGridUrlConfig","cripGridEvents"]}(angular,window.crip||(window.crip={}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9zb3VyY2UvZ3JpZC5tb2R1bGUuanMiLCIvc291cmNlL3Byb3ZpZGVycy9jcmlwR3JpZFVybENvbmZpZy5qcyIsIi9zb3VyY2UvZmFjdG9yaWVzL2NyaXBHcmlkVXJsLmpzIl0sIm5hbWVzIjpbIm5nIiwiY3JpcCIsImdyaWRVcmwiLCJtb2R1bGUiLCJhbmd1bGFyIiwid2luZG93IiwiY3JpcEdyaWRVcmxDb25maWciLCIkZ2V0IiwiZ2V0TWFwcGluZ3MiLCJtYXBwaW5ncyIsInNldE1hcHBpbmdzIiwicGFnZSIsInBlclBhZ2UiLCJ0b3RhbCIsImRpcmVjdGlvbiIsIm9yZGVyIiwiZmlsdGVycyIsIm5hbWUiLCJ0aGlzIiwicHJvdmlkZXIiLCIkaW5qZWN0IiwiY3JpcEdyaWRVcmwiLCIkbG9nIiwiJGxvY2F0aW9uIiwiZXZlbnRzIiwiZXh0ZW5kIiwicGFyYW1zIiwib25PdGhlckdyaWRDaGFuZ2VzIiwid2hlcmUiLCJzZWFyY2giLCJzY29wZSIsImdyaWQiLCJwYWdpbmF0aW9uIiwic29ydCIsImZpZWxkIiwibG9vcFVybCIsImtleSIsInByb3AiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGxiYWNrIiwidXJsIiwiZm9yRWFjaCIsInZhbHVlIiwiaW5kZXhPZiIsImNsZWFyVXJsUGFyYW1zIiwicmV0IiwidmFsIiwiZ2V0RnJvbVVybE9yIiwidXJsTmFtZSIsInNvdXJjZSIsInNvdXJjZU5hbWUiLCJyZXN1bHQiLCJpc1RoaXNHcmlkIiwidGhpc05hbWUiLCJncmlkTmFtZSIsIiRvbiIsImRhdGFDaGFuZ2VkIiwiZSIsImRhdGEiLCJmaWx0ZXJzQ2hhbmdlZCIsImlzRGVmaW5lZCIsInNvcnRDaGFuZ2VkIiwicGFnaW5hdGlvbkNoYW5nZWQiLCIkd2F0Y2giLCJuIiwibyIsImVxIiwiZXF1YWxzIiwidXJsUGVyUGFnZSIsInBhZ2VTaXplcyIsIiRicm9hZGNhc3QiLCJleHRlcm5hbGx5Q2hhbmdlZCIsIiRpbmplY3RvciIsImluamVjdG9yIiwicGx1Z2lucyIsInBsdWdpbl9wYXJhbXMiLCJwbHVnaW4iLCJQbHVnaW5JbnN0YW5jZSIsImdldCIsInBhZ2luYXRlIiwiZmFjdG9yeSJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBQUEsRUFBQUMsR0FDQSxZQUVBQSxHQUFBQyxRQUFBRixFQUFBRyxPQUFBLGlCQUNBLFlBQ0EsZUFHQUMsUUFBQUMsT0FBQUosT0FBQUksT0FBQUosVUNSQSxTQUFBRCxFQUFBQyxHQUNBLFlBT0EsU0FBQUssS0FRQSxRQUFBQyxLQUNBLE9BQ0FDLFlBQUFBLEdBSUEsUUFBQUEsS0FDQSxNQUFBQyxHQUdBLFFBQUFDLEdBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEdBQ0EsTUFBQVIsSUFDQUUsS0FBQUEsR0FBQSxZQUNBQyxRQUFBQSxHQUFBLGdCQUNBQyxNQUFBQSxHQUFBLGFBQ0FDLFVBQUFBLEdBQUEsaUJBQ0FDLE1BQUFBLEdBQUEsYUFDQUMsUUFBQUEsR0FBQSxlQUNBQyxLQUFBQSxHQUFBLGFBekJBLEdBQUFSLEdBQUFDLEdBRUFRLE1BQUFWLFlBQUFBLEVBQ0FVLEtBQUFSLFlBQUFBLEVBRUFRLEtBQUFYLE1BQUFBLEdBWEFOLEVBQUFDLFFBQ0FpQixTQUFBLG9CQUFBYixHQUVBQSxFQUFBYyxZQWdDQWhCLFFBQUFDLE9BQUFKLE9BQUFJLE9BQUFKLFVDdENBLFNBQUFELEVBQUFDLEdBQ0EsWUFTQSxTQUFBb0IsR0FBQUMsRUFBQUMsRUFBQWpCLEVBQUFrQixHQUtBLFFBQUFDLEdBQUFDLEdBaUhBLFFBQUFDLEdBQUFDLEdBRUFMLEVBQUFNLE9BQUFwQixFQUFBLEtBQUFpQixFQUFBVCxNQUNBTSxFQUFBTSxPQUFBcEIsRUFBQSxLQUFBaUIsRUFBQUksTUFBQUMsS0FBQUMsV0FBQXJCLE1BQ0FZLEVBQUFNLE9BQUFwQixFQUFBLE1BQUFpQixFQUFBSSxNQUFBQyxLQUFBQyxXQUFBbkIsT0FDQVUsRUFBQU0sT0FBQXBCLEVBQUEsUUFBQWlCLEVBQUFJLE1BQUFDLEtBQUFDLFdBQUFwQixTQUNBVyxFQUFBTSxPQUFBcEIsRUFBQSxVQUFBaUIsRUFBQUksTUFBQUMsS0FBQUUsS0FBQW5CLFdBQ0FTLEVBQUFNLE9BQUFwQixFQUFBLE1BQUFpQixFQUFBSSxNQUFBQyxLQUFBRSxLQUFBQyxPQUVBQyxFQUFBLFNBQUFDLEdBRUFiLEVBQUFNLE9BQUFPLEVBQUEsT0FHQSxLQUFBLEdBQUFDLEtBQUFYLEdBQUFJLE1BQUFDLEtBQUFmLFFBQ0FVLEVBQUFJLE1BQUFDLEtBQUFmLFFBQUFzQixlQUFBRCxJQUNBZCxFQUFBTSxPQUFBUSxFQUFBWCxFQUFBSSxNQUFBQyxLQUFBZixRQUFBcUIsSUFJQSxRQUFBRixHQUFBSSxHQUNBLEdBQUFDLEdBQUFqQixFQUFBTSxRQUNBN0IsR0FBQXlDLFFBQUFELEVBQUEsU0FBQUUsRUFBQU4sR0FDQSxLQUFBVixFQUFBSSxNQUFBQyxLQUFBUyxJQUFBZCxPQUFBaUIsUUFBQVAsSUFDQUcsRUFBQUgsRUFBQU0sS0FJQSxRQUFBRSxLQUNBLEdBQUFDLEtBSUEsT0FIQVYsR0FBQSxTQUFBQyxFQUFBVSxHQUNBRCxFQUFBVCxHQUFBVSxJQUVBRCxFQUdBLFFBQUFFLEdBQUFDLEVBQUFDLEVBQUFDLEdBQ0FBLEVBQUFBLEdBQUFGLENBQ0EsSUFBQUcsR0FBQTVCLEVBQUFNLFNBQUFtQixJQUFBQyxFQUFBQyxFQU9BLE9BQUFDLEdBR0EsUUFBQUMsS0FDQSxHQUFBQyxHQUFBM0IsRUFBQVQsS0FDQXFDLEVBQUEvQixFQUFBTSxTQUFBcEIsRUFBQSxLQU9BLE9BQUE2QyxJQUFBQSxJQUFBRCxHQUNBLEVBRUFDLEdBS0EsR0FKQS9CLEVBQUFNLE9BQUFwQixFQUFBLEtBQUE0QyxJQUNBLEdBOUtBLEdBQUE1QyxHQUFBSCxFQUFBRSxhQUNBa0IsR0FBQUksTUFBQUMsS0FBQVMsS0FDQWQsUUFDQWpCLEVBQUEsS0FDQUEsRUFBQSxRQUNBQSxFQUFBLE1BQ0FBLEVBQUEsVUFDQUEsRUFBQSxNQUNBQSxFQUFBLFFBQ0FBLEVBQUEsT0FJQTJDLE1BRUExQixFQUFBSSxNQUFBQyxLQUFBQyxXQUFBckIsS0FDQW9DLEVBQUF0QyxFQUFBLEtBQUFpQixFQUFBSSxNQUFBQyxLQUFBQyxXQUFBLFFBQ0FOLEVBQUFJLE1BQUFDLEtBQUFDLFdBQUFuQixNQUNBa0MsRUFBQXRDLEVBQUEsTUFBQWlCLEVBQUFJLE1BQUFDLEtBQUFDLFdBQUEsU0FDQU4sRUFBQUksTUFBQUMsS0FBQUMsV0FBQXBCLFFBQ0FtQyxFQUFBdEMsRUFBQSxRQUFBaUIsRUFBQUksTUFBQUMsS0FBQUMsV0FBQSxXQUdBTixFQUFBSSxNQUFBQyxLQUFBRSxLQUFBbkIsVUFDQWlDLEVBQUF0QyxFQUFBLFVBQUFpQixFQUFBSSxNQUFBQyxLQUFBRSxLQUFBLGFBQ0FQLEVBQUFJLE1BQUFDLEtBQUFFLEtBQUFDLE1BQ0FhLEVBQUF0QyxFQUFBLE1BQUFpQixFQUFBSSxNQUFBQyxLQUFBRSxLQUFBLFNBR0FQLEVBQUFJLE1BQUFDLEtBQUFmLFFBQUE0QixLQUFBbEIsRUFBQUksTUFBQUMsS0FBQWYsU0FHQVUsRUFBQUksTUFBQXlCLElBQUEvQixFQUFBZ0MsWUFBQSxTQUFBQyxFQUFBQyxHQUNBTixLQUNBN0IsRUFBQU0sT0FBQXBCLEVBQUEsTUFBQWlELEVBQUE3QyxTQUdBYSxFQUFBSSxNQUFBeUIsSUFBQS9CLEVBQUFtQyxlQUFBLFNBQUFGLEVBQUFDLEdBQ0FOLEtBQ0FqQixFQUFBLFNBQUFDLEdBRUFwQyxFQUFBNEQsVUFBQUYsRUFBQTFDLFFBQUFvQixLQUNBYixFQUFBTSxPQUFBTyxFQUFBLFFBR0FwQyxFQUFBeUMsUUFBQWlCLEVBQUExQyxRQUFBLFNBQUE4QixFQUFBVixHQUNBYixFQUFBTSxPQUFBTyxFQUFBVSxNQUdBbkIsRUFBQSxLQUdBRCxFQUFBSSxNQUFBeUIsSUFBQS9CLEVBQUFxQyxZQUFBLFNBQUFKLEVBQUFDLEdBQ0FOLEtBQ0E3QixFQUFBTSxPQUFBcEIsRUFBQSxVQUFBaUQsRUFBQTVDLFdBQ0FTLEVBQUFNLE9BQUFwQixFQUFBLE1BQUFpRCxFQUFBeEIsUUFFQVAsRUFBQSxLQUdBRCxFQUFBSSxNQUFBeUIsSUFBQS9CLEVBQUFzQyxrQkFBQSxTQUFBTCxFQUFBQyxHQUNBTixLQUNBN0IsRUFBQU0sT0FBQXBCLEVBQUEsS0FBQWlELEVBQUEvQyxNQUNBWSxFQUFBTSxPQUFBcEIsRUFBQSxRQUFBaUQsRUFBQTlDLFNBQ0FXLEVBQUFNLE9BQUFwQixFQUFBLE1BQUFpRCxFQUFBN0MsUUFFQWMsRUFBQSxLQUlBRCxFQUFBSSxNQUFBaUMsT0FBQSxXQUNBLE1BQUF4QyxHQUFBTSxVQUNBLFNBQUFtQyxFQUFBQyxHQUNBLEdBQUFiLElBQUEsQ0FDQSxHQUFBYyxHQUFBbEUsRUFBQW1FLE9BQ0FBLElBQUFELEVBQUFGLEVBQUFDLEdBQ0FyRCxFQUFBSCxFQUFBLFFBQ0EyRCxFQUFBSixFQUFBcEQsRUFFQSxNQUFBYyxFQUFBSSxNQUFBQyxLQUFBQyxXQUFBcUMsVUFBQTFCLFFBQUF5QixJQUNBN0MsRUFBQU0sT0FBQWpCLEVBQUFxRCxFQUFBckQsSUFHQXVELEdBQ0F6QyxFQUFBSSxNQUFBd0MsV0FBQTlDLEVBQUErQyxtQkFDQXRDLE1BQ0FDLE1BQUE4QixFQUFBdkQsRUFBQSxPQUNBSyxVQUFBa0QsRUFBQXZELEVBQUEsWUFFQXVCLFlBQ0FyQixLQUFBcUQsRUFBQXZELEVBQUEsTUFDQUksTUFBQW1ELEVBQUF2RCxFQUFBLE9BQ0FHLFFBQUFvRCxFQUFBcEQsSUFFQUksUUFBQTRCLElBQ0EzQixLQUFBK0MsRUFBQXZELEVBQUEsVUFLQSxJQUFBK0QsR0FBQXhFLEVBQUF5RSxVQUNBekUsR0FBQXlDLFFBQUFmLEVBQUFnRCxRQUFBLFNBQUFDLEVBQUFDLEdBQ0EsR0FBQUMsR0FBQUwsRUFBQU0sSUFBQUYsRUFFQUMsR0FBQXBELFFBQ0FLLE1BQUFKLEVBQUFJLE1BQ0FpRCxTQUFBckQsRUFBQXFELFNBQ0E5RCxLQUFBUyxFQUFBVCxLQUNBeUQsUUFBQUMsTUFqSEEsT0FDQWxELE9BQUFBLEdBVEF4QixFQUFBQyxRQUNBOEUsUUFBQSxjQUFBM0QsR0FFQUEsRUFBQUQsU0FBQSxPQUFBLFlBQUEsb0JBQUEsbUJBK0xBaEIsUUFBQUMsT0FBQUosT0FBQUksT0FBQUoiLCJmaWxlIjoiY3JpcC1ncmlkLXVybC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKG5nLCBjcmlwKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgY3JpcC5ncmlkVXJsID0gbmcubW9kdWxlKCdjcmlwLmdyaWQtdXJsJywgW1xyXG4gICAgICAgICdjcmlwLmNvcmUnLFxyXG4gICAgICAgICdjcmlwLmdyaWQnXHJcbiAgICBdKTtcclxuXHJcbn0pKGFuZ3VsYXIsIHdpbmRvdy5jcmlwIHx8ICh3aW5kb3cuY3JpcCA9IHt9KSk7IiwiKGZ1bmN0aW9uIChuZywgY3JpcCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGNyaXAuZ3JpZFVybFxyXG4gICAgICAgIC5wcm92aWRlcignY3JpcEdyaWRVcmxDb25maWcnLCBjcmlwR3JpZFVybENvbmZpZyk7XHJcblxyXG4gICAgY3JpcEdyaWRVcmxDb25maWcuJGluamVjdCA9IFtdO1xyXG5cclxuICAgIGZ1bmN0aW9uIGNyaXBHcmlkVXJsQ29uZmlnKCkge1xyXG4gICAgICAgIHZhciBtYXBwaW5ncyA9IHNldE1hcHBpbmdzKCk7XHJcblxyXG4gICAgICAgIHRoaXMuZ2V0TWFwcGluZ3MgPSBnZXRNYXBwaW5ncztcclxuICAgICAgICB0aGlzLnNldE1hcHBpbmdzID0gc2V0TWFwcGluZ3M7XHJcblxyXG4gICAgICAgIHRoaXMuJGdldCA9IFskZ2V0XTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gJGdldCgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGdldE1hcHBpbmdzOiBnZXRNYXBwaW5nc1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0TWFwcGluZ3MoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBtYXBwaW5ncztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldE1hcHBpbmdzKHBhZ2UsIHBlclBhZ2UsIHRvdGFsLCBkaXJlY3Rpb24sIG9yZGVyLCBmaWx0ZXJzLCBuYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBtYXBwaW5ncyA9IHtcclxuICAgICAgICAgICAgICAgIHBhZ2U6IHBhZ2UgfHwgJ2dyaWQtcGFnZScsXHJcbiAgICAgICAgICAgICAgICBwZXJQYWdlOiBwZXJQYWdlIHx8ICdncmlkLXBlci1wYWdlJyxcclxuICAgICAgICAgICAgICAgIHRvdGFsOiB0b3RhbCB8fCAnZ3JpZC10b3RhbCcsXHJcbiAgICAgICAgICAgICAgICBkaXJlY3Rpb246IGRpcmVjdGlvbiB8fCAnZ3JpZC1kaXJlY3Rpb24nLFxyXG4gICAgICAgICAgICAgICAgb3JkZXI6IG9yZGVyIHx8ICdncmlkLW9yZGVyJyxcclxuICAgICAgICAgICAgICAgIGZpbHRlcnM6IGZpbHRlcnMgfHwgJ2dyaWQtZmlsdGVycycsXHJcbiAgICAgICAgICAgICAgICBuYW1lOiBuYW1lIHx8ICdncmlkLW5hbWUnXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KShhbmd1bGFyLCB3aW5kb3cuY3JpcCB8fCAod2luZG93LmNyaXAgPSB7fSkpOyIsIihmdW5jdGlvbiAobmcsIGNyaXApIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBjcmlwLmdyaWRVcmxcclxuICAgICAgICAuZmFjdG9yeSgnY3JpcEdyaWRVcmwnLCBjcmlwR3JpZFVybCk7XHJcblxyXG4gICAgY3JpcEdyaWRVcmwuJGluamVjdCA9IFsnJGxvZycsICckbG9jYXRpb24nLCAnY3JpcEdyaWRVcmxDb25maWcnLCAnY3JpcEdyaWRFdmVudHMnXTtcclxuXHJcbiAgICAvLyBwbHVnaW4gZm9yIGNyaXBHcmlkIGZhY3RvcnlcclxuICAgIC8vIGV4dGVuZCBtZXRob2QgY2FuIGJlIGNhbGxlZCBvbmx5IHdpdGgge25hbWUsIHNjb3BlLCBwYWdpbmF0ZSwgcGx1Z2luc31cclxuICAgIGZ1bmN0aW9uIGNyaXBHcmlkVXJsKCRsb2csICRsb2NhdGlvbiwgY3JpcEdyaWRVcmxDb25maWcsIGV2ZW50cykge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGV4dGVuZDogZXh0ZW5kXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZXh0ZW5kKHBhcmFtcykge1xyXG4gICAgICAgICAgICB2YXIgbWFwcGluZ3MgPSBjcmlwR3JpZFVybENvbmZpZy5nZXRNYXBwaW5ncygpO1xyXG4gICAgICAgICAgICBwYXJhbXMuc2NvcGUuZ3JpZC51cmwgPSB7XHJcbiAgICAgICAgICAgICAgICBwYXJhbXM6IFtcclxuICAgICAgICAgICAgICAgICAgICBtYXBwaW5nc1sncGFnZSddLFxyXG4gICAgICAgICAgICAgICAgICAgIG1hcHBpbmdzWydwZXJQYWdlJ10sXHJcbiAgICAgICAgICAgICAgICAgICAgbWFwcGluZ3NbJ3RvdGFsJ10sXHJcbiAgICAgICAgICAgICAgICAgICAgbWFwcGluZ3NbJ2RpcmVjdGlvbiddLFxyXG4gICAgICAgICAgICAgICAgICAgIG1hcHBpbmdzWydvcmRlciddLFxyXG4gICAgICAgICAgICAgICAgICAgIG1hcHBpbmdzWydmaWx0ZXJzJ10sXHJcbiAgICAgICAgICAgICAgICAgICAgbWFwcGluZ3NbJ25hbWUnXVxyXG4gICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgaWYgKGlzVGhpc0dyaWQoKSkge1xyXG4gICAgICAgICAgICAgICAgLy8gc2V0IGdyaWQgcGFnaW5hdGlvbiBmcm9tIHVybCwgb3Igc2V0IGRlZmF1bHRcclxuICAgICAgICAgICAgICAgIHBhcmFtcy5zY29wZS5ncmlkLnBhZ2luYXRpb24ucGFnZVxyXG4gICAgICAgICAgICAgICAgICAgID0gZ2V0RnJvbVVybE9yKG1hcHBpbmdzWydwYWdlJ10sIHBhcmFtcy5zY29wZS5ncmlkLnBhZ2luYXRpb24sICdwYWdlJyk7XHJcbiAgICAgICAgICAgICAgICBwYXJhbXMuc2NvcGUuZ3JpZC5wYWdpbmF0aW9uLnRvdGFsXHJcbiAgICAgICAgICAgICAgICAgICAgPSBnZXRGcm9tVXJsT3IobWFwcGluZ3NbJ3RvdGFsJ10sIHBhcmFtcy5zY29wZS5ncmlkLnBhZ2luYXRpb24sICd0b3RhbCcpO1xyXG4gICAgICAgICAgICAgICAgcGFyYW1zLnNjb3BlLmdyaWQucGFnaW5hdGlvbi5wZXJQYWdlXHJcbiAgICAgICAgICAgICAgICAgICAgPSBnZXRGcm9tVXJsT3IobWFwcGluZ3NbJ3BlclBhZ2UnXSwgcGFyYW1zLnNjb3BlLmdyaWQucGFnaW5hdGlvbiwgJ3BlclBhZ2UnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBzZXQgZ3JpZCBzb3J0IG9wdGlvbnMgZnJvbSB1cmwsIG9yIHNldCBkZWZhdWx0XHJcbiAgICAgICAgICAgICAgICBwYXJhbXMuc2NvcGUuZ3JpZC5zb3J0LmRpcmVjdGlvblxyXG4gICAgICAgICAgICAgICAgICAgID0gZ2V0RnJvbVVybE9yKG1hcHBpbmdzWydkaXJlY3Rpb24nXSwgcGFyYW1zLnNjb3BlLmdyaWQuc29ydCwgJ2RpcmVjdGlvbicpO1xyXG4gICAgICAgICAgICAgICAgcGFyYW1zLnNjb3BlLmdyaWQuc29ydC5maWVsZFxyXG4gICAgICAgICAgICAgICAgICAgID0gZ2V0RnJvbVVybE9yKG1hcHBpbmdzWydvcmRlciddLCBwYXJhbXMuc2NvcGUuZ3JpZC5zb3J0LCAnZmllbGQnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBzZXQgZmlsdGVycyBmcm9tIHVybCwgb3Igc2V0IGRlZmF1bHRcclxuICAgICAgICAgICAgICAgIHBhcmFtcy5zY29wZS5ncmlkLmZpbHRlcnMgPSBjbGVhclVybFBhcmFtcygpIHx8IHBhcmFtcy5zY29wZS5ncmlkLmZpbHRlcnM7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHBhcmFtcy5zY29wZS4kb24oZXZlbnRzLmRhdGFDaGFuZ2VkLCBmdW5jdGlvbiAoZSwgZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzVGhpc0dyaWQoKSlcclxuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24uc2VhcmNoKG1hcHBpbmdzWyd0b3RhbCddLCBkYXRhLnRvdGFsKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBwYXJhbXMuc2NvcGUuJG9uKGV2ZW50cy5maWx0ZXJzQ2hhbmdlZCwgZnVuY3Rpb24gKGUsIGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGlmIChpc1RoaXNHcmlkKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBsb29wVXJsKGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYga2V5IGV4aXN0cyBpbiB1cmwsIGJ1dCBub3QgaW4gZmlsdGVycywgcmVtb3ZlIGl0IGZyb20gdXJsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbmcuaXNEZWZpbmVkKGRhdGEuZmlsdGVyc1trZXldKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5zZWFyY2goa2V5LCBudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBhZGQvdXBkYXRlIGFsbCBmaWx0ZXJzIHRvIHVybFxyXG4gICAgICAgICAgICAgICAgICAgIG5nLmZvckVhY2goZGF0YS5maWx0ZXJzLCBmdW5jdGlvbiAodmFsLCBrZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnNlYXJjaChrZXksIHZhbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgICAgICAgICBvbk90aGVyR3JpZENoYW5nZXMoMSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcGFyYW1zLnNjb3BlLiRvbihldmVudHMuc29ydENoYW5nZWQsIGZ1bmN0aW9uIChlLCBkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNUaGlzR3JpZCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnNlYXJjaChtYXBwaW5nc1snZGlyZWN0aW9uJ10sIGRhdGEuZGlyZWN0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24uc2VhcmNoKG1hcHBpbmdzWydvcmRlciddLCBkYXRhLmZpZWxkKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIG9uT3RoZXJHcmlkQ2hhbmdlcygyKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBwYXJhbXMuc2NvcGUuJG9uKGV2ZW50cy5wYWdpbmF0aW9uQ2hhbmdlZCwgZnVuY3Rpb24gKGUsIGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGlmIChpc1RoaXNHcmlkKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24uc2VhcmNoKG1hcHBpbmdzWydwYWdlJ10sIGRhdGEucGFnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnNlYXJjaChtYXBwaW5nc1sncGVyUGFnZSddLCBkYXRhLnBlclBhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5zZWFyY2gobWFwcGluZ3NbJ3RvdGFsJ10sIGRhdGEudG90YWwpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgb25PdGhlckdyaWRDaGFuZ2VzKDMpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIHdhdGNoIHVybCBjaGFuZ2VzXHJcbiAgICAgICAgICAgIHBhcmFtcy5zY29wZS4kd2F0Y2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICRsb2NhdGlvbi5zZWFyY2goKVxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAobiwgbykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzVGhpc0dyaWQoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBlcSA9IG5nLmVxdWFscyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXF1YWxzID0gISFlcShuLCBvKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGVyUGFnZSA9IG1hcHBpbmdzWydwZXJQYWdlJ10sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybFBlclBhZ2UgPSBuW3BlclBhZ2VdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAocGFyYW1zLnNjb3BlLmdyaWQucGFnaW5hdGlvbi5wYWdlU2l6ZXMuaW5kZXhPZih1cmxQZXJQYWdlKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnNlYXJjaChwZXJQYWdlLCBvW3BlclBhZ2VdKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghZXF1YWxzKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXMuc2NvcGUuJGJyb2FkY2FzdChldmVudHMuZXh0ZXJuYWxseUNoYW5nZWQsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvcnQ6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZDogblttYXBwaW5nc1snb3JkZXInXV0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiBuW21hcHBpbmdzWydkaXJlY3Rpb24nXV1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZTogblttYXBwaW5nc1sncGFnZSddXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbDogblttYXBwaW5nc1sndG90YWwnXV0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVyUGFnZTogbltwZXJQYWdlXVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcnM6IGNsZWFyVXJsUGFyYW1zKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBuW21hcHBpbmdzWyduYW1lJ11dXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHZhciAkaW5qZWN0b3IgPSBuZy5pbmplY3RvcigpO1xyXG4gICAgICAgICAgICBuZy5mb3JFYWNoKHBhcmFtcy5wbHVnaW5zLCBmdW5jdGlvbiAocGx1Z2luX3BhcmFtcywgcGx1Z2luKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgUGx1Z2luSW5zdGFuY2UgPSAkaW5qZWN0b3IuZ2V0KHBsdWdpbik7XHJcbiAgICAgICAgICAgICAgICAvLyBlbmFibGUgcGx1Z2lucyB7bmFtZSwgc2NvcGUsIHBhZ2luYXRlLCBwbHVnaW5zfVxyXG4gICAgICAgICAgICAgICAgUGx1Z2luSW5zdGFuY2UuZXh0ZW5kKHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZTogcGFyYW1zLnNjb3BlLFxyXG4gICAgICAgICAgICAgICAgICAgIHBhZ2luYXRlOiBwYXJhbXMucGFnaW5hdGUsXHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogcGFyYW1zLm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgcGx1Z2luczogcGx1Z2luX3BhcmFtc1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gb25PdGhlckdyaWRDaGFuZ2VzKHdoZXJlKSB7XHJcbiAgICAgICAgICAgICAgICAvLyRsb2cubG9nKHsnb25PdGhlckdyaWRDaGFuZ2VzJzogd2hlcmV9KTtcclxuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5zZWFyY2gobWFwcGluZ3NbJ25hbWUnXSwgcGFyYW1zLm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnNlYXJjaChtYXBwaW5nc1sncGFnZSddLCBwYXJhbXMuc2NvcGUuZ3JpZC5wYWdpbmF0aW9uLnBhZ2UpO1xyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnNlYXJjaChtYXBwaW5nc1sndG90YWwnXSwgcGFyYW1zLnNjb3BlLmdyaWQucGFnaW5hdGlvbi50b3RhbCk7XHJcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24uc2VhcmNoKG1hcHBpbmdzWydwZXJQYWdlJ10sIHBhcmFtcy5zY29wZS5ncmlkLnBhZ2luYXRpb24ucGVyUGFnZSk7XHJcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24uc2VhcmNoKG1hcHBpbmdzWydkaXJlY3Rpb24nXSwgcGFyYW1zLnNjb3BlLmdyaWQuc29ydC5kaXJlY3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnNlYXJjaChtYXBwaW5nc1snb3JkZXInXSwgcGFyYW1zLnNjb3BlLmdyaWQuc29ydC5maWVsZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgbG9vcFVybChmdW5jdGlvbiAoa2V5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVtb3ZlIGFsbCBmaWx0ZXJzIGZyb20gdXJsIGJlZm9yZSBhZGRpbmcgZnJvbSBvdGhlciBncmlkXHJcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnNlYXJjaChrZXksIG51bGwpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBwYXJhbXMuc2NvcGUuZ3JpZC5maWx0ZXJzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmFtcy5zY29wZS5ncmlkLmZpbHRlcnMuaGFzT3duUHJvcGVydHkocHJvcCkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5zZWFyY2gocHJvcCwgcGFyYW1zLnNjb3BlLmdyaWQuZmlsdGVyc1twcm9wXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGxvb3BVcmwoY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgIHZhciB1cmwgPSAkbG9jYXRpb24uc2VhcmNoKCk7XHJcbiAgICAgICAgICAgICAgICBuZy5mb3JFYWNoKHVybCwgZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocGFyYW1zLnNjb3BlLmdyaWQudXJsLnBhcmFtcy5pbmRleE9mKGtleSkgPT09IC0xKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhrZXksIHZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBjbGVhclVybFBhcmFtcygpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXQgPSB7fTtcclxuICAgICAgICAgICAgICAgIGxvb3BVcmwoZnVuY3Rpb24gKGtleSwgdmFsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0W2tleV0gPSB2YWw7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldEZyb21VcmxPcih1cmxOYW1lLCBzb3VyY2UsIHNvdXJjZU5hbWUpIHtcclxuICAgICAgICAgICAgICAgIHNvdXJjZU5hbWUgPSBzb3VyY2VOYW1lIHx8IHVybE5hbWU7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gJGxvY2F0aW9uLnNlYXJjaCgpW3VybE5hbWVdIHx8IHNvdXJjZVtzb3VyY2VOYW1lXTtcclxuICAgICAgICAgICAgICAgIC8vJGxvZy5sb2coJ2NyaXBHcmlkVXJsIC0+IGdldEZyb21VcmxPcicsIHtcclxuICAgICAgICAgICAgICAgIC8vICAgIHJlc3VsdDogcmVzdWx0LFxyXG4gICAgICAgICAgICAgICAgLy8gICAgdXJsTmFtZTogdXJsTmFtZSxcclxuICAgICAgICAgICAgICAgIC8vICAgIHNvdXJjZTogc291cmNlLFxyXG4gICAgICAgICAgICAgICAgLy8gICAgc291cmNlTmFtZTogc291cmNlTmFtZVxyXG4gICAgICAgICAgICAgICAgLy99KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGlzVGhpc0dyaWQoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGhpc05hbWUgPSBwYXJhbXMubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICBncmlkTmFtZSA9ICRsb2NhdGlvbi5zZWFyY2goKVttYXBwaW5nc1snbmFtZSddXTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyRsb2cubG9nKCdjcmlwR3JpZFVybCAtPiBpc1RoaXNHcmlkJywge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgIHRoaXNOYW1lOiB0aGlzTmFtZSxcclxuICAgICAgICAgICAgICAgIC8vICAgICBncmlkTmFtZTogZ3JpZE5hbWVcclxuICAgICAgICAgICAgICAgIC8vIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChncmlkTmFtZSAmJiBncmlkTmFtZSA9PT0gdGhpc05hbWUpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCFncmlkTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5zZWFyY2gobWFwcGluZ3NbJ25hbWUnXSwgdGhpc05hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoYW5ndWxhciwgd2luZG93LmNyaXAgfHwgKHdpbmRvdy5jcmlwID0ge30pKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
